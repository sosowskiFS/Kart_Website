<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Test</title>

    <style type="text/css">
        .col-header {
            padding: 0.5rem 1rem;
            margin-bottom: 0;
            background-color: rgba(0,0,0,.03);
            border-bottom: 1px solid #dee2e6;
        }

        .col-no-padding {
            padding-left: 0;
            padding-right: 0;
        }

        .border-right {
            border-right: 1px solid #dee2e6;
        }

        .border-left {
            border-left: 1px solid #dee2e6;
        }

        .flex-center-content {
            height: 100%;
            align-items: center;
        }

        .row {
            margin-left: 0;
            margin-right: 0;
        }

        @media (min-width: 0px) {
            .ks-1440 {
                display: none;
            }

            .ks-576 {
                display: flex;
            }

            .longtext {
                font-size: 0.8em;
                margin-bottom: 1.3rem;
            }

            .moving-left-border {
                border-left: none;
                border-top: 1px solid #dee2e6;
            }

            .phonetext {
                font-size: 0.8em;
            }

            .tBorderRight {
                border-right: none;
            }

            .tBorderBottom {
                border-bottom: none;
            }

            .tBorderLeft {
                border-left: none;
            }

            .tBorderTop {
                border-top: none;
            }

            .h6longtext {
                font-size: 0.8rem;
            }

            .searchBar {
                max-width: 100%
            }
        }

        @media (min-width: 477px) {
            .tBorderRight {
                border-right: 1px solid #dee2e6;
            }

            .tBorderBottom {
                border-bottom: 1px solid #dee2e6;
            }

            .tBorderLeft {
                border-left: 1px solid #dee2e6;
            }

            .tBorderTop {
                border-top: 1px solid #dee2e6;
            }

            .h6longtext {
                font-size: 1rem;
            }
        }

        @media (min-width: 576px) {
            .longtext {
                font-size: 1em;
                margin-bottom: 1rem;
            }

            .moving-left-border {
                border-left: none;
                border-top: 1px solid #dee2e6;
            }

            .phonetext {
                font-size: 1.25rem;
            }
        }

        @media (min-width: 768px) {
            .ks-1440 {
                display: flex;
            }

            .ks-576 {
                display: none;
            }

            .longtext {
                font-size: 0.8em;
                margin-bottom: 1.3rem;
            }

            .moving-left-border {
                border-top: none;
                border-left: 1px solid #dee2e6;
            }

            .searchBar {
                max-width: 50%
            }
        }

        @media (min-width: 992px) {
            .longtext {
                font-size: 1em;
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 1200px) {
        }

        @media (min-width: 1200px) {
        }

        @media (min-width: 1400px) {
        }
    </style>
</head>
<body>
    <main>
        <div class="container" style="margin-top:1em; margin-bottom:1em;">
            <h1 class="display-4">Player Card</h1>
            <span id="errMessage" style="display: none; color: #d11525;">Player not found</span>
            <form class="d-flex searchBar" defaultbutton="searchButton" onsubmit="lookupPlayer();return false">
                <input id="playerSearch" class="form-control me-2" type="search" placeholder="Search for a player..." aria-label="Search Players">
                <button id="searchButton" class="btn btn-outline-success" type="button" onclick="lookupPlayer()">Search</button>
            </form>
            <img src="img/lg-sonic.png" style="display:inline-block; margin-bottom:18px;" /><h5 id="pName" style="display:inline-block;" class="display-6">Player Name</h5>
            <ul class="nav nav-tabs" id="op2Tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">Details</button>
                </li>
            </ul>
            <div class="tab-content" id="tabParent">
                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                    <div class="row" style="border-left: 1px solid #dee2e6; border-right: 1px solid #dee2e6; border-bottom: 1px solid #dee2e6;">
                        <div class="d-none d-md-block col-3 text-center" style="margin-top: 0.5em;">
                            <img src="img/Acrid.png" class="img-fluid" alt="..." width="160" height="160">
                        </div>
                        <div class="col-md-9 col-12 text-center" style="margin-top: 0.5em;">
                            <div class="row" style="align-items: center;">
                                <div class="col-4">
                                    <div class="row" style="align-items: center;">
                                        <div class="col" style="padding:0;">
                                            <img src="img/gold.png" width="50" height="50" class="img-fluid" />
                                        </div>
                                    </div>
                                    <div class="row" style="align-items: center;">
                                        <div class="col" style="padding:0;">
                                            <h5 id="goldStat" class="phonetext">9,999,999</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="row" style="align-items: center;">
                                        <div class="col" style="padding:0;">
                                            <img src="img/silver.png" width="50" height="50" class="img-fluid" />
                                        </div>
                                    </div>
                                    <div class="row" style="align-items: center;">
                                        <div class="col" style="padding:0;">
                                            <h5 id="silverStat" class="phonetext">9,999,999</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="row" style="align-items: center;">
                                        <div class="col" style="padding:0;">
                                            <img src="img/copper.png" width="50" height="50" class="img-fluid" />
                                        </div>
                                    </div>
                                    <div class="row" style="align-items: center;">
                                        <div class="col" style="padding:0;">
                                            <h5 id="bronzeStat" class="phonetext">9,999,999</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="align-items: center;margin-bottom: 0.5em;">
                                <div class="progress" style="height: 25px; padding: 0;">
                                    <div id="barGold" class="progress-bar bg-warning" role="progressbar" style="width: 10%;" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"><h6 id="perGold" class="h6longtext" style="margin-bottom: 0;color: #000;">10%</h6></div>
                                    <div id="barSilver" class="progress-bar" role="progressbar" style="width: 15%; background-color: #adadad;" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"><h6 id="perSilver" class="h6longtext" style="margin-bottom: 0; color: #000;">15%</h6></div>
                                    <div id="barBronze" class="progress-bar" role="progressbar" style="width: 20%; background-color: #ad7251;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><h6 id="perBronze" class="h6longtext" style="margin-bottom: 0; color: #000;">20%</h6></div>
                                    <div id="barTotal" class="progress-bar" role="progressbar" style="width: 55%;" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100"><h6 id="raceTotal" class="h6longtext" style="margin-bottom: 0;">9,999,999 Races</h6></div>
                                </div>
                            </div>
                            <div class="row" style="align-items: center;">
                                <div class="col-4">
                                    <div class="row" style="align-items: center;">
                                        <div class="col">
                                            <img src="img/Sonic-Robo-Blast-2-Kart-logo.png" width="50" height="50" class="img-fluid" />
                                        </div>
                                    </div>
                                    <div class="row" style="align-items: center;">
                                        <div class="col">
                                            <h5 id="ksVanilla">9999</h5>
                                            <h6 id="ksVanillaRank" class="card-subtitle mb-2 text-muted">Rank 9999</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="row" style="align-items: center;">
                                        <div class="col">
                                            <img src="img/2691.jpg" width="50" height="50" class="img-fluid" />
                                        </div>
                                    </div>
                                    <div class="row" style="align-items: center;">
                                        <div class="col">
                                            <h5 id="ksJuice">9999</h5>
                                            <h6 id="ksJuiceRank" class="card-subtitle mb-2 text-muted">Rank 9999</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="row" style="align-items: center;">
                                        <div class="col">
                                            <img src="img/K_ITSHOE2.png" width="50" height="50" class="img-fluid" />
                                        </div>
                                    </div>
                                    <div class="row" style="align-items: center;">
                                        <div class="col">
                                            <h5 id="ksNitro">9999</h5>
                                            <h6 id="ksNitroRank" class="card-subtitle mb-2 text-muted">Rank 9999</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
                    <div class="row" style="padding: 0; border-left: 1px solid #dee2e6; border-right: 1px solid #dee2e6; border-bottom: 1px solid #dee2e6;">
                        <div class="col col-no-padding border-right text-center">
                            <div class="col-header" style="border-bottom: 1px solid #dee2e6">
                                Overall
                            </div>
                            <div class="row ks-576">
                                <div class="col col-sm-6 tBorderRight">
                                    <p>Races</p>
                                    <h5 id="dRaces">9,999,999</h5>
                                </div>
                                <div class="col col-sm-6">
                                    <p>Wins</p>
                                    <h5 id="dWins">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-576 tBorderTop">
                                <div class="col col-sm-12">
                                    <p>Win Percent</p>
                                    <h5 id="dWinPercent">99.99%</h5>
                                </div>
                            </div>
                            <div class="row ks-1440">
                                <div class="col tBorderRight">
                                    <p>Races</p>
                                    <h5 id="dRaces2">9,999,999</h5>
                                </div>
                                <div class="col tBorderRight">
                                    <p>Wins</p>
                                    <h5 id="dWins2">9,999,999</h5>
                                </div>
                                <div class="col">
                                    <p>Win Percent</p>
                                    <h5 id="dWinPercent2">99.99%</h5>
                                </div>
                            </div>
                            <div class="row ks-576 tBorderTop">
                                <div class="col col-sm-6 tBorderRight">
                                    <p class="longtext">Second Places</p>
                                    <h5 id="dSecond">9,999,999</h5>
                                </div>
                                <div class="col col-sm-6">
                                    <p>Third Places</p>
                                    <h5 id="dThird">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-576 tBorderTop">
                                <div class="col col-sm-12">
                                    <p class="longtext">Podium Percent</p>
                                    <h5 id="dPodium">99.99%</h5>
                                </div>
                            </div>
                            <div class="row ks-1440 tBorderTop">
                                <div class="col tBorderRight">
                                    <p class="longtext">Second Places</p>
                                    <h5 id="dSecond2">9,999,999</h5>
                                </div>
                                <div class="col tBorderRight">
                                    <p>Third Places</p>
                                    <h5 id="dThird2">9,999,999</h5>
                                </div>
                                <div class="col">
                                    <p class="longtext">Podium Percent</p>
                                    <h5 id="dPodium2">99.99%</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col col-no-padding text-center">
                            <div class="col-header" style="border-bottom: 1px solid #dee2e6">
                                Item Hits
                            </div>
                            <div class="row ks-576">
                                <div class="col col-sm-12">
                                    <p>Hits</p>
                                    <h5 id="dHits">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-576 tBorderTop">
                                <div class="col col-sm-12">
                                    <p class="longtext">Self/Environment Hits</p>
                                    <h5 id="dSelf">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-1440">
                                <div class="col tBorderRight">
                                    <p>Hits</p>
                                    <h5 id="dHits2">9,999,999</h5>
                                </div>
                                <div class="col">
                                    <p class="longtext">Self/Environment Hits</p>
                                    <h5 id="dSelf2">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-576 tBorderTop">
                                <div class="col col-sm-6 tBorderRight">
                                    <p>Spun Out</p>
                                    <h5 id="dSpin">9,999,999</h5>
                                </div>
                                <div class="col col-sm-6">
                                    <p>Exploded</p>
                                    <h5 id="dExploded">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-576 tBorderTop">
                                <div class="col col-sm-12">
                                    <p>Squished</p>
                                    <h5 id="dSquish">9,999,999</h5>
                                </div>
                            </div>
                            <div class="row ks-1440 tBorderTop">
                                <div class="col tBorderRight">
                                    <p>Spun Out</p>
                                    <h5 id="dSpin2">9,999,999</h5>
                                </div>
                                <div class="col tBorderRight">
                                    <p>Exploded</p>
                                    <h5 id="dExploded2">9,999,999</h5>
                                </div>
                                <div class="col">
                                    <p>Squished</p>
                                    <h5 id="dSquish2">9,999,999</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <h1 class="display-4">Map Records</h1>
            <div class="row" style="border: 1px solid #dee2e6">
                <div class="col col-no-padding text-center">
                    <div class="col-header">
                        <h4>Ridge Turnpike</h4>
                    </div>
                    <div class="row" style="align-items: center;">
                        <div class="col-md-4">
                            <img src="img/RidgeTurnpike.png" class="img-fluid" alt="..." width="215px">
                        </div>
                        <div class="col-md-8 col-no-padding moving-left-border">
                            <div class="row">
                                <div class="col" style="border-right:1px solid #dee2e6;">
                                    <p>Races</p>
                                    <h5>99999</h5>
                                </div>
                                <div class="col">
                                    <p>RTVs</p>
                                    <h5>99999</h5>
                                </div>
                            </div>
                            <div class="row" style="border-top:1px solid #dee2e6;">
                                <div class="col" style="border-right:1px solid #dee2e6;">
                                    <p class="longtext">Vanilla/Tech Record</p>
                                    <h5>99'99"99</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">Player Name</h6>
                                </div>
                                <div class="col" style="border-right:1px solid #dee2e6;">
                                    <p>Juice Record</p>
                                    <h5>99'99"99</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">Player Name</h6>
                                </div>
                                <div class="col">
                                    <p>Nitro Record</p>
                                    <h5>99'99"99</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">Player Name</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        //Fun fact this won't run on local files because CORS can go blow me
        let rawPlayerData = ""
        let rawMapData = ""
        let rawSkinData = ""
        let rawTimeData = ""
        let playerData = []
        let mapData = []
        let skinData = []
        let timeData = []

        async function getPlayerData() {
            return fetch("https://onyomanya.github.io/data/Playerdata.txt").then(res => res.text()).then(text => { return text })
        }
        async function getMapData() {
            return fetch("https://onyomanya.github.io/data/Mapdata.txt").then(res => res.text()).then(text => { return text })
        }
        async function getSkinData() {
            return fetch("https://onyomanya.github.io/data/Skincounter.txt").then(res => res.text()).then(text => { return text })
        }
        async function getTimeData() {
            return fetch("https://onyomanya.github.io/data/Timerecords.txt").then(res => res.text()).then(text => { return text })
        }
        async function callPlayerData() {
            rawPlayerData = await this.getPlayerData();
            rawMapData = await this.getMapData();
            rawSkinData = await this.getSkinData();
            rawTimeData = await this.getTimeData();

            //Initial data organization needs to happen in this function as this is the only place JS will wait for the above
            let playerDataStep1 = rawPlayerData.split(/\r?\n/);
            for (const t of playerDataStep1) {
                if (t.length > 0) {
                    playerData.push(t.split(";"))
                }
            }

            let mapDataStep1 = rawMapData.split(/\r?\n/);
            for (const t of mapDataStep1) {
                if (t.length > 0) {
                    mapData.push(t.split(";"))
                }
            }

            let skinDataStep1 = rawSkinData.split(/\r?\n/);
            for (const t of skinDataStep1) {
                if (t.length > 0) {
                    skinData.push(t.split(";"))
                }
            }

            let timeDataStep1 = rawTimeData.split(/\r?\n/);
            for (const t of timeDataStep1) {
                if (t.length > 0) {
                    timeData.push(t.split(";"))
                }
            }

            applyPlayerData("Onyo");
        }

        function findKSRank(pName, type) {
            let cloneList = playerData
            let tIndex = -1
            switch (type.toLowerCase()) {
                case 'vanilla':
                    tIndex = 10
                    break;
                case 'juice':
                    tIndex = 11
                    break;
                case 'nitro':
                    tIndex = 12
                    break;
            }
            cloneList.sort(function (a, b) {
                return b[tIndex] - a[tIndex];
            });
            let posCounter = 1
            for (const p of cloneList) {
                if (pName.toLowerCase() == p[0].toLowerCase()) {
                    return posCounter;
                    break;
                }
                posCounter += 1;
            }

            return "N/A";
        }

        //https://www.w3schools.com/howto/howto_js_autocomplete.asp

        function applyPlayerData(pName) {
            //Fill the example table here
            //For loop, check first element until desired key matches, copy data to everything.
            let found = false;
            for (const d of playerData) {
                if (d[0].toLowerCase() == pName.toLowerCase()) {
                    $("#errMessage").css("display", "none");
                    $("#playerSearch").val("")
                    found = true;
                    //Overview screen
                    $("#pName").text(d[0]);
                    $('#raceTotal').text(parseInt(d[1]).toLocaleString("en-US") + " Races")

                    //Calculate percentage of gold/silver/bronze, round to nearest full percent, and fill the remainder to 100%
                    let raceTotal = parseInt(d[1])
                    let gold = parseInt(d[2])
                    let silver = parseInt(d[8])
                    let bronze = parseInt(d[9])
                    let goldPer = Math.round((gold / raceTotal) * 100)
                    let silverPer = Math.round((silver / raceTotal) * 100)
                    let bronzePer = Math.round((bronze / raceTotal) * 100)
                    let totalPer = Math.abs((goldPer + silverPer + bronzePer) - 100)

                    $("#goldStat").text(gold.toLocaleString("en-US"))
                    $("#silverStat").text(silver.toLocaleString("en-US"))
                    $("#bronzeStat").text(bronze.toLocaleString("en-US"))

                    $("#barGold").css("width", goldPer.toString() + "%")
                    $("#barSilver").css("width", silverPer.toString() + "%")
                    $("#barBronze").css("width", bronzePer.toString() + "%")
                    $("#barTotal").css("width", totalPer.toString() + "%")

                    $("#perGold").text(goldPer.toString() + "%")
                    $("#perSilver").text(silverPer.toString() + "%")
                    $("#perBronze").text(bronzePer.toString() + "%")

                    $("#ksVanilla").text(d[10])
                    $("#ksJuice").text(d[11])
                    $("#ksNitro").text(d[12])

                    $("#ksVanillaRank").text("Rank " + findKSRank(d[0], "vanilla"))
                    $("#ksJuiceRank").text("Rank " + findKSRank(d[0], "juice"))
                    $("#ksNitroRank").text("Rank " + findKSRank(d[0], "nitro"))

                    //Detail screen
                    $('#dRaces').text(parseInt(d[1]).toLocaleString("en-US"))
                    $('#dRaces2').text(parseInt(d[1]).toLocaleString("en-US"))
                    $("#dWins").text(gold.toLocaleString("en-US"))
                    $("#dWins2").text(gold.toLocaleString("en-US"))
                    let fullWinPer = ((gold / raceTotal) * 100).toFixed(2)
                    $("#dWinPercent").text(fullWinPer.toString() + "%")
                    $("#dWinPercent2").text(fullWinPer.toString() + "%")
                    $("#dSecond").text(silver.toLocaleString("en-US"))
                    $("#dSecond2").text(silver.toLocaleString("en-US"))
                    $("#dThird").text(bronze.toLocaleString("en-US"))
                    $("#dThird2").text(bronze.toLocaleString("en-US"))
                    let podiumPer = (((gold / raceTotal) * 100) + ((silver / raceTotal) * 100) + ((bronze / raceTotal) * 100)).toFixed(2)
                    $("#dPodium").text(podiumPer.toString() + "%")
                    $("#dPodium2").text(podiumPer.toString() + "%")

                    $("#dHits").text(d[3].toLocaleString("en-US"))
                    $("#dHits2").text(d[3].toLocaleString("en-US"))
                    $("#dSelf").text(d[4].toLocaleString("en-US"))
                    $("#dSelf2").text(d[4].toLocaleString("en-US"))
                    $("#dSpin").text(d[5].toLocaleString("en-US"))
                    $("#dSpin2").text(d[5].toLocaleString("en-US"))
                    $("#dExploded").text(d[6].toLocaleString("en-US"))
                    $("#dExploded2").text(d[6].toLocaleString("en-US"))
                    $("#dSquish").text(d[7].toLocaleString("en-US"))
                    $("#dSquish2").text(d[7].toLocaleString("en-US"))

                    break;
                }
            }

            if (!found) {
                $("#errMessage").css("display", "inline");
            }
        }

        function lookupPlayer() {
            let pName = $("#playerSearch").val()
            if (pName.length > 0) {
                applyPlayerData(pName);
            } else {
                $("#errMessage").css("display", "inline");
            }
        }

        $(document).ready(function () {
            callPlayerData()
        })


    </script>
</body>
</html>